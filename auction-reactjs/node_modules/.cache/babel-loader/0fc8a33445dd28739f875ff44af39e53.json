{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/bar1s/Desktop/react/auction/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/bar1s/Desktop/react/auction/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/bar1s/Desktop/react/auction/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import Input from'./Input';import{useEffect,useState}from'react';import ButtonWithProgress from'./ButtonWithProgress';import{postIdImage,putIdentity}from'../Api/ApiCalls';import{useSelector}from'react-redux';import{useParams}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var VerifyAccount=function VerifyAccount(props){var _useState=useState(),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),newImage=_useState4[0],setNewImage=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),idNumber=_useState6[0],setIdNumber=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),imageId=_useState8[0],setImageId=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),imageError=_useState10[0],setImageError=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),idError=_useState12[0],setIdError=_useState12[1];var _useSelector=useSelector(function(store){return{username:store.username};}),loggedInUsername=_useSelector.username;var numberRegex=/^[0-9]+$/;var routeParams=useParams();var pathUsername=routeParams.username;var isOwner=loggedInUsername===pathUsername;useEffect(function(){setError(undefined);},[newImage,idNumber]);useEffect(function(){setImageError(undefined);},[imageId]);var onChangeFile=function onChangeFile(event){if(event.target.files.length<1){return;}var file=event.target.files[0];var fileReader=new FileReader();fileReader.onload=function(){setNewImage(fileReader.result);uploadFile(file);};fileReader.readAsDataURL(file);};var uploadFile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(file){var attachment,response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:attachment=new FormData();attachment.append('file',file);_context.prev=2;_context.next=5;return postIdImage(attachment);case 5:response=_context.sent;setImageId(response.data.id);setImageError(undefined);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](2);setImageError(_context.t0.response.data);case 13:case\"end\":return _context.stop();}}},_callee,null,[[2,10]]);}));return function uploadFile(_x){return _ref.apply(this,arguments);};}();var saveId=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var body;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(idNumber.match(numberRegex)){_context2.next=3;break;}setError(\"Id number must be numeric\");return _context2.abrupt(\"return\");case 3:body={idNumber:idNumber,imageId:imageId,loggedInUsername:loggedInUsername};_context2.prev=4;_context2.next=7;return putIdentity(body);case 7:setError(undefined);props.history.push('/');_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](4);setError(_context2.t0.response.data);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[4,11]]);}));return function saveId(){return _ref2.apply(this,arguments);};}();var onChangeIdNumber=function onChangeIdNumber(event){var digit=Math.max(Math.floor(Math.log10(Math.abs(event.target.value))),0)+1;if(digit==11){setIdError(undefined);}else{setIdError(\"Id number must be 11 digits\");}setIdNumber(event.target.value);setError(undefined);};var html=\"\";if(isOwner){html=/*#__PURE__*/_jsxs(\"div\",{className:\"container card\",style:{background:'#f3f5f5'},children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-center card-header\",children:\"ID Verification\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"img-thumbnail\",width:\"400\",height:\"400\",src:newImage,alt:\"...\"}),/*#__PURE__*/_jsx(Input,{label:\"Add ID photo\",type:\"file\",onChange:onChangeFile,error:imageError}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(Input,{label:\"ID number\",type:\"text\",onChange:onChangeIdNumber,error:idError}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",role:\"alert\",children:error}),/*#__PURE__*/_jsx(ButtonWithProgress,{onClick:saveId,text:\"Upload ID\",disabled:idError})]})]});}else{props.history.push('/');}return/*#__PURE__*/_jsx(\"div\",{children:html});};export default VerifyAccount;","map":{"version":3,"names":["React","Input","useEffect","useState","ButtonWithProgress","postIdImage","putIdentity","useSelector","useParams","VerifyAccount","props","error","setError","newImage","setNewImage","idNumber","setIdNumber","imageId","setImageId","imageError","setImageError","idError","setIdError","store","username","loggedInUsername","numberRegex","routeParams","pathUsername","isOwner","undefined","onChangeFile","event","target","files","length","file","fileReader","FileReader","onload","result","uploadFile","readAsDataURL","attachment","FormData","append","response","data","id","saveId","match","body","history","push","onChangeIdNumber","digit","Math","max","floor","log10","abs","value","html","background"],"sources":["C:/Users/bar1s/Desktop/react/auction/src/Components/VerifyAccount.js"],"sourcesContent":["import React from 'react';\r\nimport Input from './Input';\r\nimport { useEffect, useState } from 'react';\r\nimport ButtonWithProgress from './ButtonWithProgress';\r\nimport { postIdImage, putIdentity } from '../Api/ApiCalls';\r\nimport { useSelector } from 'react-redux';\r\nimport { useParams } from 'react-router-dom';\r\n\r\n\r\nconst VerifyAccount = (props) => {\r\n\r\n    const [error, setError] = useState();\r\n    const [newImage, setNewImage] = useState();\r\n    const [idNumber, setIdNumber] = useState();\r\n    const [imageId, setImageId] = useState();\r\n    const [imageError, setImageError] = useState();\r\n    const [idError, setIdError] = useState();\r\n    const { username: loggedInUsername } = useSelector(store => ({ username: store.username }));\r\n    const numberRegex = /^[0-9]+$/;\r\n\r\n    const routeParams = useParams();\r\n    const pathUsername = routeParams.username;\r\n\r\n    const isOwner = loggedInUsername === pathUsername;\r\n\r\n    useEffect(() => {\r\n        setError(undefined)\r\n    }, [newImage, idNumber]);\r\n\r\n    useEffect(() => {\r\n        setImageError(undefined)\r\n    }, [imageId]);\r\n\r\n    const onChangeFile = (event) => {\r\n        if (event.target.files.length < 1) {\r\n            return;\r\n        }\r\n        const file = event.target.files[0];\r\n        const fileReader = new FileReader();\r\n        fileReader.onload = () => {\r\n            setNewImage(fileReader.result);\r\n            uploadFile(file);\r\n        }\r\n        fileReader.readAsDataURL(file);\r\n    }\r\n\r\n    const uploadFile = async file => {\r\n        const attachment = new FormData();\r\n        attachment.append('file', file);\r\n        try {\r\n            const response = await postIdImage(attachment);\r\n            setImageId(response.data.id);\r\n            setImageError(undefined);\r\n        } catch (error) {\r\n            setImageError(error.response.data);\r\n        }\r\n    };\r\n\r\n\r\n    const saveId = async () => {\r\n        if (!idNumber.match(numberRegex)) {\r\n            setError(\"Id number must be numeric\");\r\n            return;\r\n        }\r\n\r\n        const body = {\r\n            idNumber,\r\n            imageId,\r\n            loggedInUsername\r\n        }\r\n        try {\r\n            await putIdentity(body)\r\n            setError(undefined)\r\n            props.history.push('/');\r\n        } catch (error) {\r\n            setError(error.response.data);\r\n        }\r\n\r\n    }\r\n\r\n    const onChangeIdNumber = (event) => {\r\n        let digit = Math.max(Math.floor(Math.log10(Math.abs(event.target.value))), 0) + 1;\r\n        if (digit == 11) {\r\n            setIdError(undefined);\r\n        } else {\r\n            setIdError(\"Id number must be 11 digits\");\r\n        }\r\n        setIdNumber(event.target.value);\r\n        setError(undefined)\r\n    }\r\n\r\n    let html = \"\";\r\n    if (isOwner) {\r\n        html = (\r\n        <div className='container card' style={{ background: '#f3f5f5' }}>\r\n            <h2 className='text-center card-header'>ID Verification</h2>\r\n            <div className='card-body'>\r\n\r\n                <img className='img-thumbnail' width=\"400\" height=\"400\" src={newImage} alt='...' />\r\n\r\n                <Input label='Add ID photo' type=\"file\" onChange={onChangeFile} error={imageError} />\r\n                <hr />\r\n\r\n                <Input label='ID number' type=\"text\" onChange={onChangeIdNumber} error={idError} />\r\n\r\n                {error && <div className=\"alert alert-danger\" role=\"alert\">\r\n                    {error}\r\n                </div>}\r\n                <ButtonWithProgress onClick={saveId} text='Upload ID' disabled={idError} />\r\n            </div>\r\n        </div>\r\n        )\r\n    }else{\r\n        props.history.push('/');\r\n    }\r\n\r\n\r\n    return (\r\n        <div>\r\n            {html}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VerifyAccount;"],"mappings":"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"},"metadata":{},"sourceType":"module"}